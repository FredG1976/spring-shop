<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE xml>
<configuration scan="true">
	<springProperty name="application.name" source="spring.application.name" />
	<springProperty name="application.timezone" source="application.timezone" />
	<springProperty name="application.orgEntity" source="application.orgEntity" />
	<springProperty name="application.version" source="application.version" />
	<springProperty name="application.environment" source="application.environment" />
	<springProperty name="application.apCode" source="application.apCode" />
	<springProperty name="application.type" source="application.type" />
	<springProperty name="application.retention" source="application.retention" />
	<springProperty name="application.token" source="application.token" />

	<springProfile name="!local">
		<appender name="console" class="ch.qos.logback.core.ConsoleAppender">
			<encoder>
	  			<pattern>%date{yyyy-MM-dd HH:mm:ss.SSSXXX} | %-5level | %X{IP} | %X{HostName} | ${application.name} | %X{X-B3-TraceId:-} | %X{X-B3-SpanId:-} | %X{UserID} | %X{Marker} | %c{36} | %msg%n</pattern>
	 		</encoder>
		</appender>
		<root level="INFO">
			<appender-ref ref="console" />
		</root>
	</springProfile>

	<springProfile name="local">
		<appender name="normeITR-v1.1.0" class="ch.qos.logback.core.ConsoleAppender">
			<encoder
				class="net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder">
				<providers>
				<timestamp>
					<timeZone>UTC</timeZone>
					<fieldName>timestamp</fieldName>
					<pattern>yyyy-MM-dd'T'HH:mm:ss.SSS'Z'</pattern>
				</timestamp>
				<pattern>
					<pattern>
						{
							"timeZone": "${application.timezone}",
							"level": "%level",
							"env": "${application.environment}",
							"laas_apcode": "${application.apCode}",
							"laas_type": "${application.type}",
							"laas_retention": "${application.retention}",
							"laas_token": "${application.token}",
							"organizationalEntity": "${application.orgEntity}",
							"apName": "${application.name}",
							"apVersion": "${application.version}",
							"nodeName": "${HOSTNAME}",
							"labels": {
								"userId": "%X{UserId}",
								"sourceIp": "%X{IP}",
								"layer": "%X{Domain}",
								"rootCorrelationId": "%X{X-B3-TraceId:-}",
								"correlationId": "%X{X-B3-SpanId:-}",
								"parentCorrelationId": "%X{X-B3-ParentSpanId:-}"
							},
							"loggerName": "%logger{40}",
							"message": "%message",
							"exception": {
								"stackTrace": "%ex"
							}
						}
					</pattern>
				</pattern>
			</providers>
			</encoder>
		</appender>
		<root level="INFO">
			<appender-ref ref="normeITR-v1.1.0" />
		</root>
	</springProfile>

	<shutdownHook class="ch.qos.logback.core.hook.DelayingShutdownHook" />

	<contextListener class="ch.qos.logback.classic.jul.LevelChangePropagator">
		<resetJUL>true</resetJUL>
	</contextListener>
</configuration>